\chapter{GPS}

\newcommand{\nmea}{NMEA 0183}
\newcommand{\wgs}{$WGS^{84}$}
\newcommand{\pulkovo}{Пулково$^{1942}$}
\newcommand{\sgs}{$SGS^{85}$}

\section{Протокол \nmea}

\nmea --- текстовый протокол связи морского и навигационного оборудования.

\bigskip

\url{http://www8.garmin.com/support/pdf/NMEA_0183.pdf}

\url{http://www8.garmin.com/support/pdf/NMEA_0183.pdf}

\url{http://ru.wikipedia.org/wiki/NMEA_0183}

\url{http://www.robosoft.info/ru/technologies/knowledgebase/nmea0183}

\bigskip

Датум \wgs

\bigskip 

\url{http://ru.wikipedia.org/wiki/WGS_84}

\bigskip
Большинство GPS приемников отдают данные по \nmea, но вместо режима последовательного
порта 4800 8N1 прописанного в протоколе, могут использовать другие режимы, характерные
для портов RS232 (9600, 115200). Координаты передаются в датуме \wgs.

\bigskip
Формат сообщения NMEA\footnote{регулярные выражения
\url{http://en.wikipedia.org/wiki/Regular_expression}}:

\begin{verbatim}
\$[A-Z]5(,<data>)+\*[0-9A-F]2<CR><LF>
\end{verbatim}

\begin{itemize}
  \item символ \verb+$+
  \item 5-буквенный идентификатор сообщения. 
  Первые две буквы --- идентификатор источника сообщения, 
  следующие три буквы --- идентификатор формата сообщения
\begin{itemize}
\item GPGGA --- данные о последнем определении местоположения
\item GPGLL --- координаты, широта/долгота
\item GPGSA --- DOP (GPS) и активные спутники
\item GPGSV --- наблюдаемые спутники
\item GPWPL --- параметры заданной точки
\item GPBOD --- азимут одной точки относительно другой
\item GPRMB --- pекомендуемый минимум навигационных данных для достижения заданной точки
\item GPRMC --- pекомендуемый минимум навигационных данных: информацию о времени, 
местоположении (\wgs), курсе и скорости, передаваемые навигационным GPS приёмником. 
Контрольная сумма обязательна для этого сообщения, интервалы передачи не должны 
превышать 2 секунды. 
\item GPRTE --- маршруты
\item HCHDG --- данные от компаса
\end{itemize}
  \item блоки данных, разделённых запятыми.
  Пустые данные, не заданные в середине строки, оставляют запятую.
  Пустые данные в конце строки могут отбрасываться вместе с запятой.
  \item символ \verb+*+
  \item двузначное hex число --- контрольная XOR-сумма всех байт в строке между 
  \verb+$+ и \verb+*+.
  \item конец строки \verb+<CR><LF> = 0x0D 0x0A = \r\n +
\end{itemize}

\section{\$GPRMC --- pекомендуемый минимум навигационных данных}

\begin{verbatim}
$GPRMC,hhmmss.ss,[AV],GGMM.MM,[NS],gggmm.mm,[EW],v.v,b.b,ddmmyy,x.x,n,m*hh<CR><LF>
\end{verbatim}

\begin{itemize}
\item GP -- приём сигналов GPS, GN -- ГЛОНАСС
\item RMC -- Recommended Minimum sentence C
\item hhmmss.ss -- время фиксации местоположения по времени UTC
\item A -- данные достоверны, V -- данные недостоверны
\item GGMM.MM -- широта, 2 цифры градусов, 2 цифры целых минут, точка и дробная часть минут;
\item N/S -- северная/южная широта
\item gggmm.mm -- долгота, 3 цифры градусов, 2 цифры целых минут, точка и дробная часть минут;
\item E/W -- восточная/западная долгота
\item v.v -- горизонтальная составляющая скорости в узлах
\item b.b -- путевой угол (направление скорости) в градусах:
$0^\circ$ север, $90^\circ$ восток, $180^\circ$ юг, $270^\circ$ запад
\item ddmmyy -- дата
\item x.x -- магнитное склонение в градусах (часто отсутствует)
\item n -- направление магнитного склонения: для получения 
магнитного курса магнитное склонение необходимо вычесть (E)
или прибавить (W) к истинному курсу
\item m -- индикатор режима: A -- автономный, D -- дифференциальный, 
E -- аппроксимация, N -- недостоверные данные (часто отсутствует, 
данное поле включая запятую отсутствует в старых версиях NMEA)
\end{itemize}

\section{Системы координат (датум)}

\url{http://ne-grusti.narod.ru/Glossary/datums.html}

\bigskip

Системы координат (datums) можно разделить на геоцентрические и топоцентрические.

В геоцентрической системе размеры эллипсоида, ориентация и положение его центра 
выбираются следующим образом:

\begin{itemize}
\item объем эллипсоида предполагается равным объему геоида;
\item большая полуось эллипсоида лежит в плоскости экватора геоида;
\item малая полуось направлена по оси вращения Земли;
\item среднеквадратичное отклонение поверхности эллипсоида от поверхности геоида 
\item минимально по всей территории земного шара.
\end{itemize}

$WGS^{72}$ и сменившая ее \wgs, а также российская \sgs\ являются геоцентрическими 
системами координат на эллипсоидах $WGS72$, $GRS80$ и $SGS85$ соответственно. В системе 
GPS/NAVSTAR используется \wgs, а в системе GLONASS --- \sgs.

Топоцентрическая (национальная) система координат появляется так: вы берете некоторый 
эллипсоид и располагаете его таким образом, чтобы для заданной территории 
среднеквадратичное отклонение поверхности эллипсоида от поверхности геоида было 
минимальным. При этом остальная часть мира вас не интересует: отклонения на другой 
стороне Земли может быть сколь угодно велико.

В России используются несколько геодезических систем координат: \pulkovo\ Пулково 1942 г., 
1963 г. и 1991 г. Система координат 1963 г. используется военными и ее параметры 
преобразования засекречены. Обычно мы пользуемся картами, составленными в системе 
\pulkovo. Она базируется на эллипсоиде Красовского.

\bigskip

Параметры преобразования для \pulkovo:

\subsection{Преобразование Bursa-Wolf (Position Vector Transformation)}

\url{http://ne-grusti.narod.ru/Glossary/transformations.html#pvt}
\bigskip

\begin{tabular}{l c c c c c c c l}
направление & dX & dY & dZ & rX & rY & rZ & M & источник \\
\hline
$WGS84 \rightarrow 1942$ & -27.0 & +135.0 & +84.5 & 0.0 & 0.0  & 0.554 & -0.2263 & Data+ \\
$1942 \rightarrow WGS84$ & +25.0 & -141.0 & -78.5 & 0.0 & 0.35 & 0.736 & 0.0 & Stefan A. Voser \\  
\end{tabular}

\subsection{Преобразование Молоденского}

\url{http://ne-grusti.narod.ru/Glossary/transformations.html#molodensky}
\bigskip

\begin{tabular}{l c c c c c l}
направление & dX & dY & dZ & da & df & источник \\
\hline
$1942 \rightarrow WGS84$ & +28.0 & -130.0 & -95.0 & -108.0 & +0.00480795 & Vladimir Zh.\\
&&&&&&Boston-PC Forum \\
$1942 \rightarrow WGS84$ & +28.0 & -130.0 & -95.0 & -108.0 & +0.00480795 & MADTRAN,\\
&&&&&&Peter H. Dana \\
$1942 \rightarrow WGS84$ & +24.0 & -123.0 & -94.0 & -108.0 & +0.00480795 & Stefan A. Voser \\
\end{tabular}

\section{Методы преобразования систем координат}
\url{http://ne-grusti.narod.ru/Glossary/transformations.html}
\bigskip

Часто требуется перейти от одной системы координат (datum) к другой. Например, вы 
хотите данные с GPS в системе координат \wgs\ наложить на карту в системе координат 
\pulkovo.

Произодить преобразование проще (математически), если сначала перевести координаты 
из географических (широта и долгота) в прямоугольные (XYZ).

Чтобы получить точные прямоугольные координаты точки на поверхности Земли, необходимо 
знать не только широту и долготу, но и ее высоту над поверхностью эллипсоида. GPS 
показывает высоту над эллипсоидом \wgs. Можно вычислить прямоугольные координаты 
только по широте и долготе, считая, что точка лежит на поверхности эллипсоида, но при 
этом точность понизится.

Высоту точки на другими эллипсоидами получить сложнее. Обычно мы знаем высоту в 
национальной системе высот. За нулевую высоту, как правило, принимается среднее 
значение уровня моря в определенной точке побережья по результатам многолетних 
наблюдений. Высоты в этой системе измеряются геодезическими методами относительно 
поверхности геоида. Поэтому, чтобы узнать высоту точки над эллипсоидом, нужно знать 
возвышение геоида над эллипсоидом в данном месте, которое трудно вычислить с хорошей 
точностью. Существуют различные математические модели геоида для разных территорий и 
для всего земного шара, которые постоянно уточняются.

На заре спутниковой геодезии, когда взаимосвязи между системами координат не были четко 
определены, а данные исследований были не очень точны, применяли простой сдвиг начала 
координат dX, dY, dZ для перехода от одной системы координат к другой. Это предполагало, 
что направления осей двух эллипсоидов параллельны (что во многих случаях не соответствует 
действительности). Для работ на небольшой территории погрешности, вносимые этим 
предположением, были меньше, чем точность самих данных. Однако, по мере накопления и 
уточнения данных и повышения точности измерений, стало очевидно, что преобразование по 
трем параметрам не подходит для больших территорий и глобального использования, если 
требуется максимальная точность и единый набор параметров преобразования.

Простейший метод --- сдвиг центра координат прямоугольной системы, предполагая, что оси 
исходной и целевой систем координат параллельны.

\begin{equation}
\left(\begin{array}{c}
X_B \\ Y_B \\ Z_B
\end{array}\right)
=
\left(\begin{array}{c}
X_A \\ Y_A \\ Z_A
\end{array}\right)
+
\left(\begin{array}{c}
dX \\ dY \\ dZ
\end{array}\right)
\end{equation}

Молоденский разработал формулы для применения параметров сдвига к географическим 
координатам.

\begin{flalign}
&
\Delta\varphi''=
\frac{206265}{\rho}\left(
-dX \sin\varphi \cos\lambda
-dY \sin\varphi \sin\lambda
+dZ \cos\varphi
+
[a\Delta f + f \Delta a]\sin 2\varphi
\right)
&\\
&
\Delta \lambda '' = 
\frac{206265}{\nabla \cos \varphi}
\left(
-dX \sin \lambda + dY \cos \lambda
\right)
&\\
&
\Delta h = dX \cos \varphi \cos \lambda 
+ dY \cos \varphi \sin \lambda 
+ dZ \sin \varphi 
+ (a \Delta f + f \Delta a) \sin ^2 \varphi - \Delta a
&
\end{flalign}

здесь $dX$, $dY$, $dZ$ --- сдвиг по осям, м;
$a$ и $f$ --- большая полуось и сжатие исходного эллипсоида;
$da$ и $df$ --- разности между большой полуосью и сжатием исходного эллипсоида и целевого 
эллипсоида.

Повышенная точность достигается преобразованием Хелмерта с семью параметрами. Есть две 
его разновидности, различающиеся присвоением знака для параметров поворота.

\begin{enumerate}
\item Position Vector Transformation (Bursa-Wolf)
\begin{equation}
\left(\begin{array}{c} X_B \\ Y_B \\ Z_B \end{array}\right) = M \cdot
\left(
\begin{array}{ccc}
1 & -Rz & +Ry \\
+Rz & 1 & -Rx \\
-Ry & +Rx & 1 \\
\end{array}
\right)
\left(\begin{array}{c} X_A \\ Y_A \\ Z_A \end{array}\right)+
\left(\begin{array}{c} dX \\ dY \\ dZ \end{array}\right)
\end{equation}
\item Coordinate Frame Transformation
\begin{equation}
\left(\begin{array}{c} X_B \\ Y_B \\ Z_B \end{array}\right) = M \cdot
\left(
\begin{array}{ccc}
1 & +Rz & -Ry \\
-Rz & 1 & +Rx \\
+Ry & -Rx & 1 \\
\end{array}
\right)
\left(\begin{array}{c} X_A \\ Y_A \\ Z_A \end{array}\right)+
\left(\begin{array}{c} dX \\ dY \\ dZ \end{array}\right)
\end{equation}
\end{enumerate}

Здесь $M$ --- это масштаб (scale), параметры берутся из описания системы координат.

\section{Геоид и эллипсоиды}
\url{http://ne-grusti.narod.ru/Glossary/ellipsoid-geoid.html}
\bigskip

\paragraph{Геоид} --- фигура сложной формы, образованная поверхностью уровня вод 
Мирового океана, 
продолженной под материками. Эта поверхность во всех точках перпендикулярна (нормальна) 
вектору силы тяжести. Отвес направлен перпендикулярно поверхности геоида, а не к центру 
Земли! Это связано с тем, что плотность Земли распределена неравномерно.

\paragraph{Эллипсоид} --- тело, полученное вращением эллипса вокруг его малой оси. 
Размеры подбирают 
так, чтобы среднеквадратичное отклонение от поверхности геоида было минимально либо по 
всей поверхности Земли, либо для заданной территории.

\bigskip 
Параметры некоторых эллипсоидов
\bigskip 

\begin{tabular}{l||l||c c c}
эллипсоид & использование & 
большая &
малая &
сжатие \\
&&полуось &полуось &$f=(a-b)/a$ \\
&&a, м&b, м&\\
\hline
Красовского&Россия и др.&6378245&6356863&1/298.3\\
(1940)&\pulkovo&&&\\
\hline
GRS80&международный&6378137&6356752.31425&1/298.25722356\\
&\wgs&&&\\
\hline
SGS85&ГЛОНАСС&&&\\
&SGS85&&&\\
\cline{1-2}
Бесселя&СССР до 1942 г.&&&\\
\end{tabular}
\bigskip 

В таблицах эллипсоидов часто указывается не полярное сжатие f, а обратная величина $1/f$, 
например, для эллипсоида Красовского $1/f = 298.3$.

Отклонения эллипсоида Красовского от геоида на территории СНГ не превышают 150 м.



\section{Tistar15}

\includegraphics{apps/GPS_TiStar15.jpg}

\bigskip Цена: 250 руб. \url{http://www.voltmaster.ru/cgi-bin/qwery.pl?id=127000056703&group=700000}

\section{WISMO228}

\includegraphics{apps/GPS_GSM_WISMO_228.jpg}

\bigskip Цена: 1070 руб. \url{http://www.voltmaster.ru/cgi-bin/qwery.pl?id=127000881980&group=700000}

 